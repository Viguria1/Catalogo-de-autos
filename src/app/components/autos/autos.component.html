<div class="container">

  <!-- Buscador -->
  <div class="buscador-container">
    <input
      type="text"
      [(ngModel)]="terminoBusqueda"
      placeholder="游댌 Buscar por modelo o marca..."
      class="buscador-input"
    />
  </div>

  <!-- Secci칩n con fondo + logos -->
  <div class="logos-con-fondo">
    <img
      class="fondo-imagen"
      src="https://images.pexels.com/photos/1545510/pexels-photo-1545510.jpeg"
      alt="Fondo Logos"
    />
    <div class="marcas-logos">
      <img
        *ngFor="let marca of marcas"
        [src]="obtenerLogoMarca(marca)"
        [alt]="marca"
        class="logo-marca"
        (click)="scrollTo(marca)"
      />
    </div>
  </div>

  <!-- Lista de autos por marca -->

<div class="text-end mb-3">
  <label for="orden">Ordenar por:</label>
  <select id="orden" [(ngModel)]="criterioOrden" (change)="ordenarAutos()" class="form-select w-auto d-inline-block ms-2">
    <option value="modelo">Modelo</option>
    <option value="precio">Precio</option>
    <option value="lanzamiento">Lanzamiento</option>
  </select>
</div>


  <div *ngFor="let marca of marcas">
    <ng-container *ngIf="hayAutosFiltrados(marca)">
      <h2 id="{{ marca }}">{{ marca }}</h2>

      <div class="autos-grid">
        <div
          class="auto-card"
          *ngFor="let auto of getAutosFiltradosPorMarca(marca)"
        >
          <img
            [src]="auto.imagen"
            [alt]="auto.modelo"
            (click)="abrirDetalle(auto)"
          />
          <div class="auto-info">
            <h5>{{ auto.modelo }}</h5>
            <p>Tipo: {{ auto.tipo }}</p>
            <p>A침o: {{ auto.lanzamiento }}</p>
            <p class="precio">{{ auto.precio | currency: 'USD' }}</p>

            <!-- Botones modo administrador -->
            <div *ngIf="modoAdmin" class="admin-buttons mt-2">
              <button class="btn btn-sm btn-danger" (click)="eliminarAuto(auto.id!)">Eliminar</button>
              <button class="btn btn-sm btn-secondary" (click)="abrirDetalle(auto); activarEdicion(auto)">Editar</button>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </div>

  <!-- Bot칩n para activar modo admin (ahora al final) -->
  <div class="text-center my-5">
    <button class="btn btn-dark" (click)="verificarPassword()">
      {{ modoAdmin ? 'Salir del modo administrador' : 'Modo administrador' }}
    </button>
  </div>

  <!-- Detalle modal -->
  <div
    class="modal-backdrop"
    *ngIf="autoSeleccionado"
    (click)="cerrarDetalle()"
  >
    <div class="modal-contenido" (click)="$event.stopPropagation()">

      <!-- MODO EDICI칍N -->
      <div *ngIf="edicionActiva && autoEnEdicion">
        <h4>Editar Auto</h4>
        <label>Modelo:</label>
        <input class="form-control mb-2" [(ngModel)]="autoEnEdicion.modelo" />

        <label>Marca:</label>
        <input class="form-control mb-2" [(ngModel)]="autoEnEdicion.marca" />

        <label>Tipo:</label>
        <input class="form-control mb-2" [(ngModel)]="autoEnEdicion.tipo" />

        <label>Lanzamiento:</label>
        <input
          type="number"
          class="form-control mb-2"
          [(ngModel)]="autoEnEdicion.lanzamiento"
        />

        <label>Precio:</label>
        <input
          type="number"
          class="form-control mb-2"
          [(ngModel)]="autoEnEdicion.precio"
        />

        <label>Imagen (URL):</label>
        <input class="form-control mb-3" [(ngModel)]="autoEnEdicion.imagen" />

        <button class="btn btn-success me-2" (click)="guardarEdicion()">Guardar</button>
        <button class="btn btn-outline-secondary" (click)="cerrarDetalle()">Cancelar</button>
      </div>

      <!-- MODO DETALLE -->
      <div *ngIf="!edicionActiva">
        <img
          [src]="autoSeleccionado.imagen"
          [alt]="autoSeleccionado.modelo"
          class="img-fluid"
        />
        <h3>{{ autoSeleccionado.modelo }}</h3>
        <p><strong>Marca:</strong> {{ autoSeleccionado.marca }}</p>
        <p><strong>Tipo:</strong> {{ autoSeleccionado.tipo }}</p>
        <p><strong>A침o:</strong> {{ autoSeleccionado.lanzamiento }}</p>
        <p><strong>Precio:</strong> {{ autoSeleccionado.precio | currency: 'USD' }}</p>
        <button class="btn btn-outline-dark" (click)="cerrarDetalle()">Cerrar</button>
      </div>

    </div>
  </div>

</div>
